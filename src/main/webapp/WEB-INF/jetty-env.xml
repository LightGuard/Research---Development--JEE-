<?xml version="1.0"?>
<!DOCTYPE Configure PUBLIC "-//Mort Bay Consulting//DTD Configure//EN" "http://jetty.mortbay.org/configure.dtd">

<Configure id="wac" class="org.mortbay.jetty.webapp.WebAppContext"> 

  <!-- This should setup the connection factory in JNDI -->
  <New id="hornetqcf" class="org.mortbay.jetty.plus.naming.Resource">
    <Arg><Ref id="wac"/></Arg>
    <Arg>jms/connectionFactory</Arg>
    <Arg>
      <New class="org.hornetq.jms.client.HornetQConnectionFactory">
        <Arg>
          <New class="org.hornetq.core.config.TransportConfiguration">
            <Arg>org.hornetq.core.remoting.impl.invm.InVMConnectorFactory</Arg>
          </New>
        </Arg>
      </New> 
    </Arg>
  </New>

  <!-- This is basically to start the server, really no point in having it in JNDI -->
  <New id="hornetqserver" class="org.mortbay.jetty.plus.naming.Resource">
    <Arg><Ref id="wac"/></Arg>
    <Arg>jms/server</Arg>
    <Arg>
      <Call class="org.hornetq.core.server.HornetQ" name="newHornetQServer">
        <Arg>
          <New class="org.hornetq.core.config.impl.ConfigurationImpl">
            <Set name="persistenceEnabled">false</Set>
            <Set name="securityEnabled">false</Set>
            <Get name="AcceptorConfigurations">
              <Call name="add">
                <Arg>
                  <New class="org.hornetq.core.config.TransportConfiguration">
                    <Arg>org.hornetq.core.remoting.impl.invm.InVMAcceptorFactory</Arg>
                  </New> 
                </Arg>
              </Call>
            </Get>
          </New>
        </Arg>
        <Call name="start" />
      </Call>
    </Arg>
  </New>

  <New class="org.mortbay.jetty.plus.naming.Resource">
    <Arg><Ref id="wac" /></Arg>
    <Arg>jms/queues/testQueue</Arg>
    <Arg>
      <New class="org.hornetq.jms.HornetQQueue">
        <Arg>testQueue</Arg>
      </New>
    </Arg>
  </New>
  
</Configure>
